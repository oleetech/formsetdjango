{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{% if form.instance.pk %}Update{% else %}Create{% endif %} Author</title>
   <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
   <script src="{% static 'js/tailwind.js' %}"></script>



   <script>




$(document).ready(function() {
    // Add button click event
    bindAddRowButtonClick('#add-row', '.remove-row-btn');

    function bindAddRowButtonClick(addButtonSelector, removeButtonSelector) {
        $(addButtonSelector).click(function() {
            addRow();
            bindRemoveRowButtonClick(removeButtonSelector); // Re-bind click event after adding row
        });
    }

    function addRow() {
        // Clone the last form container
        const lastFormContainer = $('.form-container').last();
        const newFormContainer = lastFormContainer.clone();

        // Clear input values in the cloned form
        newFormContainer.find('input').val('');
        newFormContainer.find('select').val('');
        newFormContainer.find('input[type="hidden"]').remove();

        // Append the cloned form after the last one
        lastFormContainer.after(newFormContainer);

        // Update indices and total forms after adding a new row
        updateFormElementIndices();
        updateTotalForms();
    }

    function updateFormElementIndices() {
        const prefix = 'book'; // Get the prefix from views and use it here

        $('.form-container').each(function(index, container) {
            $(container).find(':input').each(function() {
                const name = $(this).attr('name');
                if (name) { // Check if the input field has a name attribute
                    const parts = name.split('-');
                    const newName = `${prefix}-${index}-${parts.slice(2).join('-')}`;
                    $(this).attr('name', newName);
                    $(this).attr('id', `id_${newName}`); // Update the id as well if necessary
                }
            });
        });
    }

    function updateTotalForms() {
        const formPrefix = 'book'; // Get the prefix from views and use it here
        const totalFormsInput = $('#id_' + formPrefix + '-TOTAL_FORMS');
        const newTotalForms = $('.form-container').length;
        totalFormsInput.val(newTotalForms);
    }

    function bindRemoveRowButtonClick(removeButtonSelector) {
        $(removeButtonSelector).off('click').click(function() { // Use .off('click') to remove previous event bindings
            $(this).closest('.form-container').remove();
            updateFormElementIndices(); // Update form element indices after removing row
            updateTotalForms(); // Update total form count
        });
    }

    // Initial binding
    bindRemoveRowButtonClick('.remove-row-btn');
});
</script>


    
    

    
</head>
<body >
    <h1>{% if form.instance.pk %}Update{% else %}Create{% endif %} Author</h1>
  <div class="overflow-x-auto">
                <form method="post">
                    {% csrf_token %}
                    <div class="px-6 py-4 grid grid-cols-2 gap-4">
                        <div class="row">
                            {% for field in form %}
                       
                                <label for="{{ field.auto_id }}">{{ field.label }}</label>
              
                                  {{ field }}
                          
                        
                            {% endfor %}
                          </div>
                    </div>
                 
                    
                    {{ formset.management_form }}
                    <div class="formset-container">
                        <table class="w-full border-collapse border border-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    {% for field in formset.empty_form.visible_fields %}
                                        <th class="border border-gray-200 px-4 py-2">{{ field.label }}</th>
                                    {% endfor %}
                                                  
                                </tr>
                            </thead>
                            <tbody>
                                {% for form in formset %}

                                    <tr class="form-container">
                                        {% for field in form %}
                                            <td class="border border-gray-200">{{ field }}</td>

                                           
                                        {% endfor %}
                                        <td>
                                            <!-- Conditionally show the remove button -->
                                            {% if not form.instance.pk %}
                                                <button type="button" class="remove-row-btn"><img src="{% static 'images/icons/remove.png' %}" alt="Remove Icon" width="20" height="20"></button>
                                            {% endif %}
                                        </td>




                                    </tr>
                                {% endfor %}

                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t flex justify-between items-center">
                        <button type="button" id="add-row" class="text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 shadow-lg shadow-lime-500/50 dark:shadow-lg dark:shadow-lime-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
                            <img src="{% static 'images/icons/add.png' %}" alt="view Icon" width="20" height="20">
                          
                        </button>
                        <button type="submit" class="text-white bg-gradient-to-r from-cyan-500 to-blue-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-cyan-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5">{% if form.instance.pk %}Update{% else %}Save{% endif %} </button>
                    </div>
            </form>
            </div>
</body>
</html>
